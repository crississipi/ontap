"use client"

import React, { useRef, useState } from 'react'
import ProductCard from './ProductCard'
import { ProductCardProps, ProductProps } from '@/types';
import { HiOutlineArrowLongRight, HiOutlineGlobeAlt, HiOutlineXMark, HiPhone } from 'react-icons/hi2';
import Image from 'next/image';
import { FaFacebookSquare } from 'react-icons/fa';
import { HiLocationMarker } from 'react-icons/hi';

type ProdCard = ProductCardProps & ProductProps;

const countries = [
  { icon: 'ğŸ‡¦ğŸ‡«', country: 'Afghanistan', code: '+93' },
  { icon: 'ğŸ‡¦ğŸ‡±', country: 'Albania', code: '+355' },
  { icon: 'ğŸ‡©ğŸ‡¿', country: 'Algeria', code: '+213' },
  { icon: 'ğŸ‡¦ğŸ‡©', country: 'Andorra', code: '+376' },
  { icon: 'ğŸ‡¦ğŸ‡´', country: 'Angola', code: '+244' },
  { icon: 'ğŸ‡¦ğŸ‡¬', country: 'Antigua and Barbuda', code: '+1-268' },
  { icon: 'ğŸ‡¦ğŸ‡·', country: 'Argentina', code: '+54' },
  { icon: 'ğŸ‡¦ğŸ‡²', country: 'Armenia', code: '+374' },
  { icon: 'ğŸ‡¦ğŸ‡º', country: 'Australia', code: '+61' },
  { icon: 'ğŸ‡¦ğŸ‡¹', country: 'Austria', code: '+43' },
  { icon: 'ğŸ‡¦ğŸ‡¿', country: 'Azerbaijan', code: '+994' },

  { icon: 'ğŸ‡§ğŸ‡¸', country: 'Bahamas', code: '+1-242' },
  { icon: 'ğŸ‡§ğŸ‡­', country: 'Bahrain', code: '+973' },
  { icon: 'ğŸ‡§ğŸ‡©', country: 'Bangladesh', code: '+880' },
  { icon: 'ğŸ‡§ğŸ‡§', country: 'Barbados', code: '+1-246' },
  { icon: 'ğŸ‡§ğŸ‡¾', country: 'Belarus', code: '+375' },
  { icon: 'ğŸ‡§ğŸ‡ª', country: 'Belgium', code: '+32' },
  { icon: 'ğŸ‡§ğŸ‡¿', country: 'Belize', code: '+501' },
  { icon: 'ğŸ‡§ğŸ‡¯', country: 'Benin', code: '+229' },
  { icon: 'ğŸ‡§ğŸ‡¹', country: 'Bhutan', code: '+975' },
  { icon: 'ğŸ‡§ğŸ‡´', country: 'Bolivia', code: '+591' },
  { icon: 'ğŸ‡§ğŸ‡¦', country: 'Bosnia and Herzegovina', code: '+387' },
  { icon: 'ğŸ‡§ğŸ‡¼', country: 'Botswana', code: '+267' },
  { icon: 'ğŸ‡§ğŸ‡·', country: 'Brazil', code: '+55' },
  { icon: 'ğŸ‡§ğŸ‡³', country: 'Brunei', code: '+673' },
  { icon: 'ğŸ‡§ğŸ‡¬', country: 'Bulgaria', code: '+359' },
  { icon: 'ğŸ‡§ğŸ‡«', country: 'Burkina Faso', code: '+226' },
  { icon: 'ğŸ‡§ğŸ‡®', country: 'Burundi', code: '+257' },

  { icon: 'ğŸ‡°ğŸ‡­', country: 'Cambodia', code: '+855' },
  { icon: 'ğŸ‡¨ğŸ‡²', country: 'Cameroon', code: '+237' },
  { icon: 'ğŸ‡¨ğŸ‡¦', country: 'Canada', code: '+1' },
  { icon: 'ğŸ‡¨ğŸ‡»', country: 'Cape Verde', code: '+238' },
  { icon: 'ğŸ‡¨ğŸ‡«', country: 'Central African Republic', code: '+236' },
  { icon: 'ğŸ‡¹ğŸ‡©', country: 'Chad', code: '+235' },
  { icon: 'ğŸ‡¨ğŸ‡±', country: 'Chile', code: '+56' },
  { icon: 'ğŸ‡¨ğŸ‡³', country: 'China', code: '+86' },
  { icon: 'ğŸ‡¨ğŸ‡´', country: 'Colombia', code: '+57' },
  { icon: 'ğŸ‡°ğŸ‡²', country: 'Comoros', code: '+269' },
  { icon: 'ğŸ‡¨ğŸ‡¬', country: 'Congo', code: '+242' },
  { icon: 'ğŸ‡¨ğŸ‡·', country: 'Costa Rica', code: '+506' },
  { icon: 'ğŸ‡­ğŸ‡·', country: 'Croatia', code: '+385' },
  { icon: 'ğŸ‡¨ğŸ‡º', country: 'Cuba', code: '+53' },
  { icon: 'ğŸ‡¨ğŸ‡¾', country: 'Cyprus', code: '+357' },
  { icon: 'ğŸ‡¨ğŸ‡¿', country: 'Czechia', code: '+420' },

  { icon: 'ğŸ‡©ğŸ‡°', country: 'Denmark', code: '+45' },
  { icon: 'ğŸ‡©ğŸ‡¯', country: 'Djibouti', code: '+253' },
  { icon: 'ğŸ‡©ğŸ‡²', country: 'Dominica', code: '+1-767' },
  { icon: 'ğŸ‡©ğŸ‡´', country: 'Dominican Republic', code: '+1-809' },

  { icon: 'ğŸ‡ªğŸ‡¨', country: 'Ecuador', code: '+593' },
  { icon: 'ğŸ‡ªğŸ‡¬', country: 'Egypt', code: '+20' },
  { icon: 'ğŸ‡¸ğŸ‡»', country: 'El Salvador', code: '+503' },
  { icon: 'ğŸ‡¬ğŸ‡¶', country: 'Equatorial Guinea', code: '+240' },
  { icon: 'ğŸ‡ªğŸ‡·', country: 'Eritrea', code: '+291' },
  { icon: 'ğŸ‡ªğŸ‡ª', country: 'Estonia', code: '+372' },
  { icon: 'ğŸ‡¸ğŸ‡¿', country: 'Eswatini', code: '+268' },
  { icon: 'ğŸ‡ªğŸ‡¹', country: 'Ethiopia', code: '+251' },

  { icon: 'ğŸ‡«ğŸ‡¯', country: 'Fiji', code: '+679' },
  { icon: 'ğŸ‡«ğŸ‡®', country: 'Finland', code: '+358' },
  { icon: 'ğŸ‡«ğŸ‡·', country: 'France', code: '+33' },

  { icon: 'ğŸ‡¬ğŸ‡¦', country: 'Gabon', code: '+241' },
  { icon: 'ğŸ‡¬ğŸ‡²', country: 'Gambia', code: '+220' },
  { icon: 'ğŸ‡¬ğŸ‡ª', country: 'Georgia', code: '+995' },
  { icon: 'ğŸ‡©ğŸ‡ª', country: 'Germany', code: '+49' },
  { icon: 'ğŸ‡¬ğŸ‡­', country: 'Ghana', code: '+233' },
  { icon: 'ğŸ‡¬ğŸ‡·', country: 'Greece', code: '+30' },
  { icon: 'ğŸ‡¬ğŸ‡©', country: 'Grenada', code: '+1-473' },
  { icon: 'ğŸ‡¬ğŸ‡¹', country: 'Guatemala', code: '+502' },
  { icon: 'ğŸ‡¬ğŸ‡³', country: 'Guinea', code: '+224' },
  { icon: 'ğŸ‡¬ğŸ‡¼', country: 'Guinea-Bissau', code: '+245' },
  { icon: 'ğŸ‡¬ğŸ‡¾', country: 'Guyana', code: '+592' },

  { icon: 'ğŸ‡­ğŸ‡¹', country: 'Haiti', code: '+509' },
  { icon: 'ğŸ‡­ğŸ‡³', country: 'Honduras', code: '+504' },
  { icon: 'ğŸ‡­ğŸ‡º', country: 'Hungary', code: '+36' },

  { icon: 'ğŸ‡®ğŸ‡¸', country: 'Iceland', code: '+354' },
  { icon: 'ğŸ‡®ğŸ‡³', country: 'India', code: '+91' },
  { icon: 'ğŸ‡®ğŸ‡©', country: 'Indonesia', code: '+62' },
  { icon: 'ğŸ‡®ğŸ‡·', country: 'Iran', code: '+98' },
  { icon: 'ğŸ‡®ğŸ‡¶', country: 'Iraq', code: '+964' },
  { icon: 'ğŸ‡®ğŸ‡ª', country: 'Ireland', code: '+353' },
  { icon: 'ğŸ‡®ğŸ‡±', country: 'Israel', code: '+972' },
  { icon: 'ğŸ‡®ğŸ‡¹', country: 'Italy', code: '+39' },

  { icon: 'ğŸ‡¯ğŸ‡²', country: 'Jamaica', code: '+1-876' },
  { icon: 'ğŸ‡¯ğŸ‡µ', country: 'Japan', code: '+81' },
  { icon: 'ğŸ‡¯ğŸ‡´', country: 'Jordan', code: '+962' },

  { icon: 'ğŸ‡°ğŸ‡¿', country: 'Kazakhstan', code: '+7' },
  { icon: 'ğŸ‡°ğŸ‡ª', country: 'Kenya', code: '+254' },
  { icon: 'ğŸ‡°ğŸ‡®', country: 'Kiribati', code: '+686' },
  { icon: 'ğŸ‡°ğŸ‡µ', country: 'North Korea', code: '+850' },
  { icon: 'ğŸ‡°ğŸ‡·', country: 'South Korea', code: '+82' },
  { icon: 'ğŸ‡°ğŸ‡¼', country: 'Kuwait', code: '+965' },
  { icon: 'ğŸ‡°ğŸ‡¬', country: 'Kyrgyzstan', code: '+996' },

  { icon: 'ğŸ‡±ğŸ‡¦', country: 'Laos', code: '+856' },
  { icon: 'ğŸ‡±ğŸ‡»', country: 'Latvia', code: '+371' },
  { icon: 'ğŸ‡±ğŸ‡§', country: 'Lebanon', code: '+961' },
  { icon: 'ğŸ‡±ğŸ‡¸', country: 'Lesotho', code: '+266' },
  { icon: 'ğŸ‡±ğŸ‡·', country: 'Liberia', code: '+231' },
  { icon: 'ğŸ‡±ğŸ‡¾', country: 'Libya', code: '+218' },
  { icon: 'ğŸ‡±ğŸ‡®', country: 'Liechtenstein', code: '+423' },
  { icon: 'ğŸ‡±ğŸ‡¹', country: 'Lithuania', code: '+370' },
  { icon: 'ğŸ‡±ğŸ‡º', country: 'Luxembourg', code: '+352' },

  { icon: 'ğŸ‡²ğŸ‡¬', country: 'Madagascar', code: '+261' },
  { icon: 'ğŸ‡²ğŸ‡¼', country: 'Malawi', code: '+265' },
  { icon: 'ğŸ‡²ğŸ‡¾', country: 'Malaysia', code: '+60' },
  { icon: 'ğŸ‡²ğŸ‡»', country: 'Maldives', code: '+960' },
  { icon: 'ğŸ‡²ğŸ‡±', country: 'Mali', code: '+223' },
  { icon: 'ğŸ‡²ğŸ‡¹', country: 'Malta', code: '+356' },
  { icon: 'ğŸ‡²ğŸ‡­', country: 'Marshall Islands', code: '+692' },
  { icon: 'ğŸ‡²ğŸ‡·', country: 'Mauritania', code: '+222' },
  { icon: 'ğŸ‡²ğŸ‡º', country: 'Mauritius', code: '+230' },
  { icon: 'ğŸ‡²ğŸ‡½', country: 'Mexico', code: '+52' },
  { icon: 'ğŸ‡«ğŸ‡²', country: 'Micronesia', code: '+691' },
  { icon: 'ğŸ‡²ğŸ‡©', country: 'Moldova', code: '+373' },
  { icon: 'ğŸ‡²ğŸ‡¨', country: 'Monaco', code: '+377' },
  { icon: 'ğŸ‡²ğŸ‡³', country: 'Mongolia', code: '+976' },
  { icon: 'ğŸ‡²ğŸ‡ª', country: 'Montenegro', code: '+382' },
  { icon: 'ğŸ‡²ğŸ‡¦', country: 'Morocco', code: '+212' },
  { icon: 'ğŸ‡²ğŸ‡¿', country: 'Mozambique', code: '+258' },
  { icon: 'ğŸ‡²ğŸ‡²', country: 'Myanmar', code: '+95' },

  { icon: 'ğŸ‡³ğŸ‡¦', country: 'Namibia', code: '+264' },
  { icon: 'ğŸ‡³ğŸ‡·', country: 'Nauru', code: '+674' },
  { icon: 'ğŸ‡³ğŸ‡µ', country: 'Nepal', code: '+977' },
  { icon: 'ğŸ‡³ğŸ‡±', country: 'Netherlands', code: '+31' },
  { icon: 'ğŸ‡³ğŸ‡¿', country: 'New Zealand', code: '+64' },
  { icon: 'ğŸ‡³ğŸ‡®', country: 'Nicaragua', code: '+505' },
  { icon: 'ğŸ‡³ğŸ‡ª', country: 'Niger', code: '+227' },
  { icon: 'ğŸ‡³ğŸ‡¬', country: 'Nigeria', code: '+234' },
  { icon: 'ğŸ‡²ğŸ‡°', country: 'North Macedonia', code: '+389' },
  { icon: 'ğŸ‡³ğŸ‡´', country: 'Norway', code: '+47' },

  { icon: 'ğŸ‡´ğŸ‡²', country: 'Oman', code: '+968' },

  { icon: 'ğŸ‡µğŸ‡°', country: 'Pakistan', code: '+92' },
  { icon: 'ğŸ‡µğŸ‡¼', country: 'Palau', code: '+680' },
  { icon: 'ğŸ‡µğŸ‡¸', country: 'Palestine', code: '+970' },
  { icon: 'ğŸ‡µğŸ‡¦', country: 'Panama', code: '+507' },
  { icon: 'ğŸ‡µğŸ‡¬', country: 'Papua New Guinea', code: '+675' },
  { icon: 'ğŸ‡µğŸ‡¾', country: 'Paraguay', code: '+595' },
  { icon: 'ğŸ‡µğŸ‡ª', country: 'Peru', code: '+51' },
  { icon: 'ğŸ‡µğŸ‡­', country: 'Philippines', code: '+63' },
  { icon: 'ğŸ‡µğŸ‡±', country: 'Poland', code: '+48' },
  { icon: 'ğŸ‡µğŸ‡¹', country: 'Portugal', code: '+351' },

  { icon: 'ğŸ‡¶ğŸ‡¦', country: 'Qatar', code: '+974' },

  { icon: 'ğŸ‡·ğŸ‡´', country: 'Romania', code: '+40' },
  { icon: 'ğŸ‡·ğŸ‡º', country: 'Russia', code: '+7' },
  { icon: 'ğŸ‡·ğŸ‡¼', country: 'Rwanda', code: '+250' },

  { icon: 'ğŸ‡°ğŸ‡³', country: 'Saint Kitts and Nevis', code: '+1-869' },
  { icon: 'ğŸ‡±ğŸ‡¨', country: 'Saint Lucia', code: '+1-758' },
  { icon: 'ğŸ‡»ğŸ‡¨', country: 'Saint Vincent and the Grenadines', code: '+1-784' },
  { icon: 'ğŸ‡¼ğŸ‡¸', country: 'Samoa', code: '+685' },
  { icon: 'ğŸ‡¸ğŸ‡²', country: 'San Marino', code: '+378' },
  { icon: 'ğŸ‡¸ğŸ‡¹', country: 'SÃ£o TomÃ© and PrÃ­ncipe', code: '+239' },
  { icon: 'ğŸ‡¸ğŸ‡¦', country: 'Saudi Arabia', code: '+966' },
  { icon: 'ğŸ‡¸ğŸ‡³', country: 'Senegal', code: '+221' },
  { icon: 'ğŸ‡·ğŸ‡¸', country: 'Serbia', code: '+381' },
  { icon: 'ğŸ‡¸ğŸ‡¨', country: 'Seychelles', code: '+248' },
  { icon: 'ğŸ‡¸ğŸ‡±', country: 'Sierra Leone', code: '+232' },
  { icon: 'ğŸ‡¸ğŸ‡¬', country: 'Singapore', code: '+65' },
  { icon: 'ğŸ‡¸ğŸ‡°', country: 'Slovakia', code: '+421' },
  { icon: 'ğŸ‡¸ğŸ‡®', country: 'Slovenia', code: '+386' },
  { icon: 'ğŸ‡¸ğŸ‡§', country: 'Solomon Islands', code: '+677' },
  { icon: 'ğŸ‡¸ğŸ‡´', country: 'Somalia', code: '+252' },
  { icon: 'ğŸ‡¿ğŸ‡¦', country: 'South Africa', code: '+27' },
  { icon: 'ğŸ‡ªğŸ‡¸', country: 'Spain', code: '+34' },
  { icon: 'ğŸ‡±ğŸ‡°', country: 'Sri Lanka', code: '+94' },
  { icon: 'ğŸ‡¸ğŸ‡©', country: 'Sudan', code: '+249' },
  { icon: 'ğŸ‡¸ğŸ‡·', country: 'Suriname', code: '+597' },
  { icon: 'ğŸ‡¸ğŸ‡ª', country: 'Sweden', code: '+46' },
  { icon: 'ğŸ‡¨ğŸ‡­', country: 'Switzerland', code: '+41' },
  { icon: 'ğŸ‡¸ğŸ‡¾', country: 'Syria', code: '+963' },

  { icon: 'ğŸ‡¹ğŸ‡¼', country: 'Taiwan', code: '+886' },
  { icon: 'ğŸ‡¹ğŸ‡¯', country: 'Tajikistan', code: '+992' },
  { icon: 'ğŸ‡¹ğŸ‡¿', country: 'Tanzania', code: '+255' },
  { icon: 'ğŸ‡¹ğŸ‡­', country: 'Thailand', code: '+66' },
  { icon: 'ğŸ‡¹ğŸ‡±', country: 'Timor-Leste', code: '+670' },
  { icon: 'ğŸ‡¹ğŸ‡¬', country: 'Togo', code: '+228' },
  { icon: 'ğŸ‡¹ğŸ‡´', country: 'Tonga', code: '+676' },
  { icon: 'ğŸ‡¹ğŸ‡¹', country: 'Trinidad and Tobago', code: '+1-868' },
  { icon: 'ğŸ‡¹ğŸ‡³', country: 'Tunisia', code: '+216' },
  { icon: 'ğŸ‡¹ğŸ‡·', country: 'Turkey', code: '+90' },
  { icon: 'ğŸ‡¹ğŸ‡²', country: 'Turkmenistan', code: '+993' },
  { icon: 'ğŸ‡¹ğŸ‡»', country: 'Tuvalu', code: '+688' },

  { icon: 'ğŸ‡ºğŸ‡¦', country: 'Ukraine', code: '+380' },
  { icon: 'ğŸ‡¦ğŸ‡ª', country: 'United Arab Emirates', code: '+971' },
  { icon: 'ğŸ‡¬ğŸ‡§', country: 'United Kingdom', code: '+44' },
  { icon: 'ğŸ‡ºğŸ‡¸', country: 'United States', code: '+1' },
  { icon: 'ğŸ‡ºğŸ‡¾', country: 'Uruguay', code: '+598' },
  { icon: 'ğŸ‡ºğŸ‡¿', country: 'Uzbekistan', code: '+998' },
  { icon: 'ğŸ‡»ğŸ‡º', country: 'Vanuatu', code: '+678' },
  { icon: 'ğŸ‡»ğŸ‡¦', country: 'Vatican City', code: '+39' },
  { icon: 'ğŸ‡»ğŸ‡ª', country: 'Venezuela', code: '+58' },
  { icon: 'ğŸ‡»ğŸ‡³', country: 'Vietnam', code: '+84' },
  { icon: 'ğŸ‡¾ğŸ‡ª', country: 'Yemen', code: '+967' },
  { icon: 'ğŸ‡¿ğŸ‡²', country: 'Zambia', code: '+260' },
  { icon: 'ğŸ‡¿ğŸ‡¼', country: 'Zimbabwe', code: '+263' },
]

const InquireItem = ({ imgUrl, productName, productDesc, size, setInquireItem, inquire, hoverable }: ProdCard) => {
  const [step, nextStep] = useState(0);
  const [userInfo, storeUserInfo] = useState({
    name: '',
    contact: '',
    email: '',
    subject: `Product Inquiry: ${productName}`,
  });
  const [emailContent, setEmailContent] = useState(<>
                    Hello <strong>OnTap Sales/Marketing Team</strong>,
                    <br /><br />
                    I hope this message finds you well. I am reaching out to inquire about the availability and details of your <strong>{productName} OnTap Card</strong> product. Could you kindly provide me with information regarding:
                    <br /><br />
                    <ul className="list-disc list-inside space-y-2 pl-3">
                        <li>Pricing for different quantities</li>
                        <li>Available sizes and material options</li>
                        <li>Estimated production and delivery time</li>
                    </ul>

                    <br />
                    If there are any design guidelines or minimum order requirements, I would also appreciate it if you could share those details.
                    <br /><br />
                    Thank you in advance for your assistance. I look forward to your reply.
                    <br /><br />
                    Best regards,
                    <br />
                   
                    <strong className='capitalize'>{userInfo.name}</strong>
                    <br />
                    <strong>{userInfo.contact}</strong>
                    <br />
                    <strong className='lowercase'>{userInfo.email}</strong>
                </>);
                    const emailRef = useRef<HTMLDivElement | null>(null);
                    const [otp, setOtp] = useState<string>("".padEnd(6, " ")); // OTP as string
                    const inputRefs = useRef<(HTMLInputElement | null)[]>([]);
                    
                    const getInputs = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
                        const { name, value } = e.target;
                        storeUserInfo((prev) => ({
                            ...prev,
                            [name]: value,
    }));
  }

    const submitEmail = async () => {
    if (step === 0) {
        if (!userInfo.name || !userInfo.contact || !userInfo.email) {
            alert('Please fill out all required fields.');
        } else {
            try {
                const res = await fetch('/api/email-verification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        email: userInfo.email,
                        name: userInfo.name,
                    }),
                });

                const data = await res.json();

                if (data.success) {
                    alert('OTP sent successfully!');
                    nextStep(1);
                } else {
                    alert('Failed to send OTP: ' + data.message)
                }
            } catch (err) {
                console.log('Error sending OTP: ' + err);
            }
        }
    } else if (step === 1) {
        try {
            const res = await fetch('/api/verify-otp', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: userInfo.email,
                    otp: otp,
                }),
            });

            const data = await res.json();

            if (data.success) {
                alert('OTP Matched.');
                nextStep(2);
                setEmailContent(
                <>
                    Hello <strong>OnTap Sales/Marketing Team</strong>,
                    <br />
                    <br />
                    I hope this message finds you well. I am reaching out to inquire about the availability and details of your{' '}
                    <strong>{productName}</strong> product. Could you kindly provide me with information regarding:
                    <br />
                    <br />
                    <ul className="list-disc list-inside space-y-2 pl-3">
                    <li>Pricing for different quantities</li>
                    <li>Available sizes and material options</li>
                    <li>Estimated production and delivery time</li>
                    </ul>
                    <br />
                    If there are any design guidelines or minimum order requirements, I would also appreciate it if you could share those details.
                    <br />
                    <br />
                    Thank you in advance for your assistance. I look forward to your reply.
                    <br />
                    <br />
                    Best regards,
                    <br />
                    <strong className="capitalize">{userInfo.name}</strong>
                    <br />
                    <strong>{userInfo.contact}</strong>
                    <br />
                    <strong className="lowercase">{userInfo.email}</strong>
                </>
                );
            } else { alert('OTP not matched.')}
        } catch (err) { console.log(err) };
    } else {
        const messageHtml = emailRef.current?.innerHTML || '';

        const payload = {
            email: userInfo.email,
            name: userInfo.name,
            subject: userInfo.subject,
            message: messageHtml,
            time: new Date().toLocaleString()
        };

        try {
        const res = await fetch('/api/product-inquiry-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
        });

        const data = await res.json();

        if (data.success) {
            alert('Message sent successfully!');
            nextStep(0);
            storeUserInfo({
            name: '',
            contact: '',
            email: '',
            subject: `Product Inquiry: ${productName}`,
            });
            setOtp('');
        } else {
            alert(`Error: ${data.message}`);
        }
        } catch (error) {
            console.error('Error sending email:', error);
            alert('An unexpected error occurred.');
        }
    }
    };

  const handleInput = (e: React.ChangeEvent<HTMLInputElement>, index: number) => {
    let value = e.target.value;

    // only keep one digit
    if (value.length > 1) {
      value = value.charAt(0);
    }

    // update OTP string
    const otpArray = otp.split("");
    otpArray[index] = value;
    const newOtp = otpArray.join("");
    setOtp(newOtp);

    // move focus to next input automatically
    if (value && index < inputRefs.current.length - 1) {
      inputRefs.current[index + 1]?.focus();
    }
  };

  // clear this and all next inputs
  const handleClick = (index: number) => {
    const otpArray = otp.split("");
    for (let i = index; i < otpArray.length; i++) {
      otpArray[i] = " ";
    }
    setOtp(otpArray.join(""));
  };

  return (
    <div className='h-full w-full fixed top-0 left-0 bg-white/15 backdrop-blur-md z-100 flex items-center justify-center'>
        <div className='md:w-3/4 lg:w-1/2 h-2/3 rounded-xl bg-white shadow-md flex p-3'>
            <ProductCard  
              imgUrl={imgUrl}
              productName={productName}
              productDesc={productDesc}
              size={size}
              setInquireItem={setInquireItem} 
              inquire={inquire}
              hoverable={hoverable}
            />
            <div className='h-full w-3/5 flex flex-col items-end gap-5'>
                <span className='w-full flex justify-between items-start'>
                    <span className='flex gap-3 items-center ml-10 mt-3'>
                        <Image
                            alt='gmail icon'
                            height={500}
                            width={500}
                            src='/icons/gmaillogo.png'
                            className='w-8 aspect-square object-contain object-center'
                        />
                        <p className='font-semibold'>{step === 0 ? 'Leave Us a Message' : 'Account Verification'}</p>
                    </span>
                    <button 
                        type="button"
                        className='text-3xl text-neutral-400 rounded-full hover:bg-light-blue hover:text-rose-300 focus:bg-blue focus:text-rose-500 ease-out duration-200'
                        onClick={() => setInquireItem(false)}
                    ><HiOutlineXMark /></button>
                </span>
                <div className='h-full w-full px-10 flex flex-col gap-3 overflow-hidden mt-10'>
                    { step === 0 && (
                        <>
                            <span className='px-5 py-3 rounded-md border border-neutral-200'>
                                <input 
                                    name='name'
                                    type="text" 
                                    placeholder='Name'
                                    value={userInfo.name}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none capitalize'
                                />
                            </span>
                            <span className='px-5 py-3 rounded-md border border-neutral-200 flex gap-2 relative'>
                                <div>
                                    <input type="text" name="" id="" />
                                    <button type="button"></button>
                                </div>
                                <input 
                                    name='contact'
                                    type="text" 
                                    placeholder='Contact Number'
                                    value={userInfo.contact}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none'
                                />
                            </span>
                            <span className='px-5 py-3 rounded-md border border-neutral-200'>
                                <input 
                                    name='email'
                                    type="email" 
                                    placeholder='Email Address'
                                    value={userInfo.email}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none lowercase placeholder:capitalize'
                                />
                            </span>
                        </>
                    )}
                    { step === 1 && (
                        <>
                            <p>We sent a One-Time Code to your email  <strong>{userInfo.email}</strong>. Please check and input the OTP Key below.</p>
                            <span className='mt-auto grid grid-cols-6 gap-3 px-14'>
                                {[...Array(6)].map((_, index) => (
                                    <input
                                    key={index}
                                    type="text"
                                    inputMode="numeric"
                                    pattern="[0-9]*"
                                    maxLength={1}
                                    value={otp[index] === " " ? "" : otp[index] ?? ""}
                                    className="p-3 border border-gray-400 rounded-md text-center text-3xl text-dark-blue font-bold focus:outline-blue ease-out duration-200"
                                    ref={(el) => {
                                        inputRefs.current[index] = el;
                                    }}
                                    onChange={(e) => handleInput(e, index)}
                                    onClick={() => handleClick(index)}
                                    />
                                ))}
                            </span>
                        </>
                    )}
                    { step === 2 && (
                        <>
                            <span className='px-5 py-3 rounded-md border border-neutral-200'>
                                <input 
                                    name='subject'
                                    type="text" 
                                    placeholder='Subject'
                                    value={userInfo.subject}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none'
                                />
                            </span>
                            <div
                                ref={emailRef}
                                contentEditable
                                suppressContentEditableWarning
                                className="overflow-x-hidden px-5 py-3 rounded-md border border-neutral-200 outline-none min-h-[200px] whitespace-pre-wrap"
                            >
                                {emailContent}
                            </div>
                        </>
                    )}
                    <span className='w-full flex justify-end gap-2 mt-5'>
                        { step > 0 && (
                            <button 
                                type="button"
                                className='flex gap-2 px-4 py-2 rounded-md border border-neutral-400 text-neutral-400 items-center hover:border-neutral-700 hover:text-neutral-600 focus:border-black focus:text-black ease-out duration-200'
                                onClick={() => { step === 2 ? nextStep(1) : nextStep(0)}}
                            >Back</button>
                        )}
                        <button 
                            type="button" 
                            className='flex gap-2 px-4 py-2 rounded-md bg-light-blue items-center hover:bg-blue focus:bg-dark-blue focus:text-white ease-out duration-200'
                            onClick={submitEmail}
                        >Next<HiOutlineArrowLongRight /></button>
                    </span>
                    <span className='w-full grid grid-cols-2 gap-3 mt-auto mb-5'>
                        <p className='col-span-full'>You can also reach out via </p>
                        <a
                            href='tel:+639286935815'                            
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        ><HiPhone className='text-2xl'/>+63 928 693 5815</a>
                        <a
                            href='tel:+639772473179'                            
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        ><HiPhone className='text-2xl'/>+63 977 247 3179</a>
                        <a
                            href='https://web.facebook.com/burnboxprinting'
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        ><FaFacebookSquare className='text-2xl text-blue-700'/>/burnboxprinting</a>
                        <a
                            href="https://burnboxprinting.com/" 
                            target="_blank"
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        >
                            <HiOutlineGlobeAlt className='text-2xl text-rose-500'/>
                            burnboxprinting.com
                        </a>
                        <a 
                            href="https://www.google.com/maps/place/17+Vatican+City+Dr,+Las+Pi%C3%B1as" 
                            target="_blank"
                            className='col-span-full flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        >
                            <HiLocationMarker className='text-2xl text-rose-700'/>
                            17 Vatican City Dr, BF Resort Village, Talon 2, Las PiÃ±as City
                        </a>
                    </span>
                </div>
            </div>
        </div>
    </div>
  )
}

export default InquireItem