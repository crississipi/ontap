"use client"

import React, { useRef, useState } from 'react'
import ProductCard from './ProductCard'
import { ProductCardProps, ProductProps } from '@/types';
import { HiOutlineArrowLongRight, HiOutlineGlobeAlt, HiOutlineXMark, HiPhone } from 'react-icons/hi2';
import Image from 'next/image';
import { FaFacebookSquare } from 'react-icons/fa';
import { HiLocationMarker } from 'react-icons/hi';

type ProdCard = ProductCardProps & ProductProps;

const countries = [
    { icon: 'ğŸ‡¦ğŸ‡«', country: 'Afghanistan' },
    { icon: 'ğŸ‡¦ğŸ‡±', country: 'Albania' },
    { icon: 'ğŸ‡©ğŸ‡¿', country: 'Algeria' },
    { icon: 'ğŸ‡¦ğŸ‡¸', country: 'American Samoa' },
    { icon: 'ğŸ‡¦ğŸ‡©', country: 'Andorra' },
    { icon: 'ğŸ‡¦ğŸ‡´', country: 'Angola' },
    { icon: 'ğŸ‡¦ğŸ‡®', country: 'Anguilla' },
    { icon: 'ğŸ‡¦ğŸ‡¶', country: 'Antarctica' },
    { icon: 'ğŸ‡¦ğŸ‡¬', country: 'Antigua and Barbuda' },
    { icon: 'ğŸ‡¦ğŸ‡·', country: 'Argentina' },
    { icon: 'ğŸ‡¦ğŸ‡²', country: 'Armenia' },
    { icon: 'ğŸ‡¦ğŸ‡¼', country: 'Aruba' },
    { icon: 'ğŸ‡¦ğŸ‡º', country: 'Australia' },
    { icon: 'ğŸ‡¦ğŸ‡¹', country: 'Austria' },
    { icon: 'ğŸ‡¦ğŸ‡¿', country: 'Azerbaijan' },

    { icon: 'ğŸ‡§ğŸ‡¸', country: 'Bahamas' },
    { icon: 'ğŸ‡§ğŸ‡­', country: 'Bahrain' },
    { icon: 'ğŸ‡§ğŸ‡©', country: 'Bangladesh' },
    { icon: 'ğŸ‡§ğŸ‡§', country: 'Barbados' },
    { icon: 'ğŸ‡§ğŸ‡¾', country: 'Belarus' },
    { icon: 'ğŸ‡§ğŸ‡ª', country: 'Belgium' },
    { icon: 'ğŸ‡§ğŸ‡¿', country: 'Belize' },
    { icon: 'ğŸ‡§ğŸ‡¯', country: 'Benin' },
    { icon: 'ğŸ‡§ğŸ‡²', country: 'Bermuda' },
    { icon: 'ğŸ‡§ğŸ‡¹', country: 'Bhutan' },
    { icon: 'ğŸ‡§ğŸ‡´', country: 'Bolivia' },
    { icon: 'ğŸ‡§ğŸ‡¦', country: 'Bosnia and Herzegovina' },
    { icon: 'ğŸ‡§ğŸ‡¼', country: 'Botswana' },
    { icon: 'ğŸ‡§ğŸ‡·', country: 'Brazil' },
    { icon: 'ğŸ‡®ğŸ‡´', country: 'British Indian Ocean Territory' },
    { icon: 'ğŸ‡»ğŸ‡¬', country: 'British Virgin Islands' },
    { icon: 'ğŸ‡§ğŸ‡³', country: 'Brunei' },
    { icon: 'ğŸ‡§ğŸ‡¬', country: 'Bulgaria' },
    { icon: 'ğŸ‡§ğŸ‡«', country: 'Burkina Faso' },
    { icon: 'ğŸ‡§ğŸ‡®', country: 'Burundi' },

    { icon: 'ğŸ‡°ğŸ‡­', country: 'Cambodia' },
    { icon: 'ğŸ‡¨ğŸ‡²', country: 'Cameroon' },
    { icon: 'ğŸ‡¨ğŸ‡¦', country: 'Canada' },
    { icon: 'ğŸ‡¨ğŸ‡»', country: 'Cape Verde' },
    { icon: 'ğŸ‡°ğŸ‡¾', country: 'Cayman Islands' },
    { icon: 'ğŸ‡¨ğŸ‡«', country: 'Central African Republic' },
    { icon: 'ğŸ‡¹ğŸ‡©', country: 'Chad' },
    { icon: 'ğŸ‡¨ğŸ‡±', country: 'Chile' },
    { icon: 'ğŸ‡¨ğŸ‡³', country: 'China' },
    { icon: 'ğŸ‡¨ğŸ‡½', country: 'Christmas Island' },
    { icon: 'ğŸ‡¨ğŸ‡¨', country: 'Cocos (Keeling) Islands' },
    { icon: 'ğŸ‡¨ğŸ‡´', country: 'Colombia' },
    { icon: 'ğŸ‡°ğŸ‡²', country: 'Comoros' },
    { icon: 'ğŸ‡¨ğŸ‡¬', country: 'Congo' },
    { icon: 'ğŸ‡¨ğŸ‡©', country: 'Congo (Democratic Republic)' },
    { icon: 'ğŸ‡¨ğŸ‡°', country: 'Cook Islands' },
    { icon: 'ğŸ‡¨ğŸ‡·', country: 'Costa Rica' },
    { icon: 'ğŸ‡­ğŸ‡·', country: 'Croatia' },
    { icon: 'ğŸ‡¨ğŸ‡º', country: 'Cuba' },
    { icon: 'ğŸ‡¨ğŸ‡¼', country: 'CuraÃ§ao' },
    { icon: 'ğŸ‡¨ğŸ‡¾', country: 'Cyprus' },
    { icon: 'ğŸ‡¨ğŸ‡¿', country: 'Czechia' },

     { icon: 'ğŸ‡©ğŸ‡°', country: 'Denmark' },
    { icon: 'ğŸ‡©ğŸ‡¯', country: 'Djibouti' },
    { icon: 'ğŸ‡©ğŸ‡²', country: 'Dominica' },
    { icon: 'ğŸ‡©ğŸ‡´', country: 'Dominican Republic' },

    { icon: 'ğŸ‡ªğŸ‡¨', country: 'Ecuador' },
    { icon: 'ğŸ‡ªğŸ‡¬', country: 'Egypt' },
    { icon: 'ğŸ‡¸ğŸ‡»', country: 'El Salvador' },
    { icon: 'ğŸ‡¬ğŸ‡¶', country: 'Equatorial Guinea' },
    { icon: 'ğŸ‡ªğŸ‡·', country: 'Eritrea' },
    { icon: 'ğŸ‡ªğŸ‡ª', country: 'Estonia' },
    { icon: 'ğŸ‡¸ğŸ‡¿', country: 'Eswatini' },
    { icon: 'ğŸ‡ªğŸ‡¹', country: 'Ethiopia' },

    { icon: 'ğŸ‡«ğŸ‡°', country: 'Falkland Islands' },
    { icon: 'ğŸ‡«ğŸ‡´', country: 'Faroe Islands' },
    { icon: 'ğŸ‡«ğŸ‡¯', country: 'Fiji' },
    { icon: 'ğŸ‡«ğŸ‡®', country: 'Finland' },
    { icon: 'ğŸ‡«ğŸ‡·', country: 'France' },
    { icon: 'ğŸ‡¬ğŸ‡«', country: 'French Guiana' },
    { icon: 'ğŸ‡µğŸ‡«', country: 'French Polynesia' },
    { icon: 'ğŸ‡¹ğŸ‡«', country: 'French Southern Territories' },

    { icon: 'ğŸ‡¬ğŸ‡¦', country: 'Gabon' },
    { icon: 'ğŸ‡¬ğŸ‡²', country: 'Gambia' },
    { icon: 'ğŸ‡¬ğŸ‡ª', country: 'Georgia' },
    { icon: 'ğŸ‡©ğŸ‡ª', country: 'Germany' },
    { icon: 'ğŸ‡¬ğŸ‡­', country: 'Ghana' },
    { icon: 'ğŸ‡¬ğŸ‡®', country: 'Gibraltar' },
    { icon: 'ğŸ‡¬ğŸ‡·', country: 'Greece' },
    { icon: 'ğŸ‡¬ğŸ‡±', country: 'Greenland' },
    { icon: 'ğŸ‡¬ğŸ‡©', country: 'Grenada' },
    { icon: 'ğŸ‡¬ğŸ‡µ', country: 'Guadeloupe' },
    { icon: 'ğŸ‡¬ğŸ‡º', country: 'Guam' },
    { icon: 'ğŸ‡¬ğŸ‡¹', country: 'Guatemala' },
    { icon: 'ğŸ‡¬ğŸ‡¬', country: 'Guernsey' },
    { icon: 'ğŸ‡¬ğŸ‡³', country: 'Guinea' },
    { icon: 'ğŸ‡¬ğŸ‡¼', country: 'Guinea-Bissau' },
    { icon: 'ğŸ‡¬ğŸ‡¾', country: 'Guyana' },

    { icon: 'ğŸ‡­ğŸ‡¹', country: 'Haiti' },
    { icon: 'ğŸ‡­ğŸ‡³', country: 'Honduras' },
    { icon: 'ğŸ‡­ğŸ‡°', country: 'Hong Kong' },
    { icon: 'ğŸ‡­ğŸ‡º', country: 'Hungary' },

    { icon: 'ğŸ‡®ğŸ‡¸', country: 'Iceland' },
    { icon: 'ğŸ‡®ğŸ‡³', country: 'India' },
    { icon: 'ğŸ‡®ğŸ‡©', country: 'Indonesia' },
    { icon: 'ğŸ‡®ğŸ‡·', country: 'Iran' },
    { icon: 'ğŸ‡®ğŸ‡¶', country: 'Iraq' },
    { icon: 'ğŸ‡®ğŸ‡ª', country: 'Ireland' },
    { icon: 'ğŸ‡®ğŸ‡²', country: 'Isle of Man' },
    { icon: 'ğŸ‡®ğŸ‡±', country: 'Israel' },
    { icon: 'ğŸ‡®ğŸ‡¹', country: 'Italy' },

    { icon: 'ğŸ‡¯ğŸ‡²', country: 'Jamaica' },
    { icon: 'ğŸ‡¯ğŸ‡µ', country: 'Japan' },
    { icon: 'ğŸ‡¯ğŸ‡ª', country: 'Jersey' },
    { icon: 'ğŸ‡¯ğŸ‡´', country: 'Jordan' },

    { icon: 'ğŸ‡°ğŸ‡¿', country: 'Kazakhstan' },
    { icon: 'ğŸ‡°ğŸ‡ª', country: 'Kenya' },
    { icon: 'ğŸ‡°ğŸ‡®', country: 'Kiribati' },
    { icon: 'ğŸ‡½ğŸ‡°', country: 'Kosovo' },
    { icon: 'ğŸ‡°ğŸ‡¼', country: 'Kuwait' },
    { icon: 'ğŸ‡°ğŸ‡¬', country: 'Kyrgyzstan' },

    { icon: 'ğŸ‡±ğŸ‡¦', country: 'Laos' },
    { icon: 'ğŸ‡±ğŸ‡»', country: 'Latvia' },
    { icon: 'ğŸ‡±ğŸ‡§', country: 'Lebanon' },
    { icon: 'ğŸ‡±ğŸ‡¸', country: 'Lesotho' },
    { icon: 'ğŸ‡±ğŸ‡·', country: 'Liberia' },
    { icon: 'ğŸ‡±ğŸ‡¾', country: 'Libya' },
    { icon: 'ğŸ‡±ğŸ‡®', country: 'Liechtenstein' },
    { icon: 'ğŸ‡±ğŸ‡¹', country: 'Lithuania' },
    { icon: 'ğŸ‡±ğŸ‡º', country: 'Luxembourg' },

    { icon: 'ğŸ‡²ğŸ‡´', country: 'Macao' },
    { icon: 'ğŸ‡²ğŸ‡°', country: 'North Macedonia' },
    { icon: 'ğŸ‡²ğŸ‡¬', country: 'Madagascar' },
    { icon: 'ğŸ‡²ğŸ‡¼', country: 'Malawi' },
    { icon: 'ğŸ‡²ğŸ‡¾', country: 'Malaysia' },
    { icon: 'ğŸ‡²ğŸ‡»', country: 'Maldives' },
    { icon: 'ğŸ‡²ğŸ‡±', country: 'Mali' },
    { icon: 'ğŸ‡²ğŸ‡¹', country: 'Malta' },
    { icon: 'ğŸ‡²ğŸ‡­', country: 'Marshall Islands' },
    { icon: 'ğŸ‡²ğŸ‡¶', country: 'Martinique' },
    { icon: 'ğŸ‡²ğŸ‡·', country: 'Mauritania' },
    { icon: 'ğŸ‡²ğŸ‡º', country: 'Mauritius' },
    { icon: 'ğŸ‡¾ğŸ‡¹', country: 'Mayotte' },
    { icon: 'ğŸ‡²ğŸ‡½', country: 'Mexico' },
    { icon: 'ğŸ‡«ğŸ‡²', country: 'Micronesia' },
    { icon: 'ğŸ‡²ğŸ‡©', country: 'Moldova' },
    { icon: 'ğŸ‡²ğŸ‡¨', country: 'Monaco' },
    { icon: 'ğŸ‡²ğŸ‡³', country: 'Mongolia' },
    { icon: 'ğŸ‡²ğŸ‡ª', country: 'Montenegro' },
    { icon: 'ğŸ‡²ğŸ‡¸', country: 'Montserrat' },
    { icon: 'ğŸ‡²ğŸ‡¦', country: 'Morocco' },
    { icon: 'ğŸ‡²ğŸ‡¿', country: 'Mozambique' },
    { icon: 'ğŸ‡²ğŸ‡²', country: 'Myanmar' },

    { icon: 'ğŸ‡³ğŸ‡¦', country: 'Namibia' },
    { icon: 'ğŸ‡³ğŸ‡·', country: 'Nauru' },
    { icon: 'ğŸ‡³ğŸ‡µ', country: 'Nepal' },
    { icon: 'ğŸ‡³ğŸ‡±', country: 'Netherlands' },
    { icon: 'ğŸ‡³ğŸ‡¨', country: 'New Caledonia' },
    { icon: 'ğŸ‡³ğŸ‡¿', country: 'New Zealand' },
    { icon: 'ğŸ‡³ğŸ‡®', country: 'Nicaragua' },
    { icon: 'ğŸ‡³ğŸ‡ª', country: 'Niger' },
    { icon: 'ğŸ‡³ğŸ‡¬', country: 'Nigeria' },
    { icon: 'ğŸ‡³ğŸ‡º', country: 'Niue' },
    { icon: 'ğŸ‡³ğŸ‡«', country: 'Norfolk Island' },
    { icon: 'ğŸ‡°ğŸ‡µ', country: 'North Korea' },
    { icon: 'ğŸ‡²ğŸ‡µ', country: 'Northern Mariana Islands' },
    { icon: 'ğŸ‡³ğŸ‡´', country: 'Norway' },

    { icon: 'ğŸ‡´ğŸ‡²', country: 'Oman' },

    { icon: 'ğŸ‡µğŸ‡°', country: 'Pakistan' },
    { icon: 'ğŸ‡µğŸ‡¼', country: 'Palau' },
    { icon: 'ğŸ‡µğŸ‡¸', country: 'Palestine' },
    { icon: 'ğŸ‡µğŸ‡¦', country: 'Panama' },
    { icon: 'ğŸ‡µğŸ‡¬', country: 'Papua New Guinea' },
    { icon: 'ğŸ‡µğŸ‡¾', country: 'Paraguay' },
    { icon: 'ğŸ‡µğŸ‡ª', country: 'Peru' },
    { icon: 'ğŸ‡µğŸ‡­', country: 'Philippines' },
    { icon: 'ğŸ‡µğŸ‡³', country: 'Pitcairn Islands' },
    { icon: 'ğŸ‡µğŸ‡±', country: 'Poland' },
    { icon: 'ğŸ‡µğŸ‡¹', country: 'Portugal' },
    { icon: 'ğŸ‡µğŸ‡·', country: 'Puerto Rico' },

    { icon: 'ğŸ‡¶ğŸ‡¦', country: 'Qatar' },

     { icon: 'ğŸ‡·ğŸ‡ª', country: 'RÃ©union' },
    { icon: 'ğŸ‡·ğŸ‡´', country: 'Romania' },
    { icon: 'ğŸ‡·ğŸ‡º', country: 'Russia' },
    { icon: 'ğŸ‡·ğŸ‡¼', country: 'Rwanda' },

    { icon: 'ğŸ‡¼ğŸ‡¸', country: 'Samoa' },
    { icon: 'ğŸ‡¸ğŸ‡²', country: 'San Marino' },
    { icon: 'ğŸ‡¸ğŸ‡¦', country: 'Saudi Arabia' },
    { icon: 'ğŸ‡¸ğŸ‡³', country: 'Senegal' },
    { icon: 'ğŸ‡·ğŸ‡¸', country: 'Serbia' },
    { icon: 'ğŸ‡¸ğŸ‡¨', country: 'Seychelles' },
    { icon: 'ğŸ‡¸ğŸ‡±', country: 'Sierra Leone' },
    { icon: 'ğŸ‡¸ğŸ‡¬', country: 'Singapore' },
    { icon: 'ğŸ‡¸ğŸ‡½', country: 'Sint Maarten' },
    { icon: 'ğŸ‡¸ğŸ‡°', country: 'Slovakia' },
    { icon: 'ğŸ‡¸ğŸ‡®', country: 'Slovenia' },
    { icon: 'ğŸ‡¸ğŸ‡§', country: 'Solomon Islands' },
    { icon: 'ğŸ‡¸ğŸ‡´', country: 'Somalia' },
    { icon: 'ğŸ‡¿ğŸ‡¦', country: 'South Africa' },
    { icon: 'ğŸ‡°ğŸ‡·', country: 'South Korea' },
    { icon: 'ğŸ‡¸ğŸ‡¸', country: 'South Sudan' },
    { icon: 'ğŸ‡ªğŸ‡¸', country: 'Spain' },
    { icon: 'ğŸ‡±ğŸ‡°', country: 'Sri Lanka' },
    { icon: 'ğŸ‡§ğŸ‡±', country: 'St. BarthÃ©lemy' },
    { icon: 'ğŸ‡¸ğŸ‡­', country: 'St. Helena' },
    { icon: 'ğŸ‡°ğŸ‡³', country: 'St. Kitts and Nevis' },
    { icon: 'ğŸ‡±ğŸ‡¨', country: 'St. Lucia' },
    { icon: 'ğŸ‡²ğŸ‡«', country: 'St. Martin' },
    { icon: 'ğŸ‡µğŸ‡²', country: 'St. Pierre and Miquelon' },
    { icon: 'ğŸ‡»ğŸ‡¨', country: 'St. Vincent and Grenadines' },
    { icon: 'ğŸ‡¸ğŸ‡©', country: 'Sudan' },
    { icon: 'ğŸ‡¸ğŸ‡·', country: 'Suriname' },
    { icon: 'ğŸ‡¸ğŸ‡¿', country: 'Swaziland' },
    { icon: 'ğŸ‡¸ğŸ‡ª', country: 'Sweden' },
    { icon: 'ğŸ‡¨ğŸ‡­', country: 'Switzerland' },
    { icon: 'ğŸ‡¸ğŸ‡¾', country: 'Syria' },

    { icon: 'ğŸ‡¹ğŸ‡¼', country: 'Taiwan' },
    { icon: 'ğŸ‡¹ğŸ‡¯', country: 'Tajikistan' },
    { icon: 'ğŸ‡¹ğŸ‡¿', country: 'Tanzania' },
    { icon: 'ğŸ‡¹ğŸ‡­', country: 'Thailand' },
    { icon: 'ğŸ‡¹ğŸ‡±', country: 'Timor-Leste' },
    { icon: 'ğŸ‡¹ğŸ‡¬', country: 'Togo' },
    { icon: 'ğŸ‡¹ğŸ‡°', country: 'Tokelau' },
    { icon: 'ğŸ‡¹ğŸ‡´', country: 'Tonga' },
    { icon: 'ğŸ‡¹ğŸ‡¹', country: 'Trinidad and Tobago' },
    { icon: 'ğŸ‡¹ğŸ‡³', country: 'Tunisia' },
    { icon: 'ğŸ‡¹ğŸ‡·', country: 'Turkey' },
    { icon: 'ğŸ‡¹ğŸ‡²', country: 'Turkmenistan' },
    { icon: 'ğŸ‡¹ğŸ‡¨', country: 'Turks and Caicos Islands' },
    { icon: 'ğŸ‡¹ğŸ‡»', country: 'Tuvalu' },

    { icon: 'ğŸ‡ºğŸ‡¬', country: 'Uganda' },
    { icon: 'ğŸ‡ºğŸ‡¦', country: 'Ukraine' },
    { icon: 'ğŸ‡¦ğŸ‡ª', country: 'United Arab Emirates' },
    { icon: 'ğŸ‡¬ğŸ‡§', country: 'United Kingdom' },
    { icon: 'ğŸ‡ºğŸ‡¸', country: 'United States' },
    { icon: 'ğŸ‡ºğŸ‡¾', country: 'Uruguay' },
    { icon: 'ğŸ‡ºğŸ‡¿', country: 'Uzbekistan' },

    { icon: 'ğŸ‡»ğŸ‡º', country: 'Vanuatu' },
    { icon: 'ğŸ‡»ğŸ‡¦', country: 'Vatican City' },
    { icon: 'ğŸ‡»ğŸ‡ª', country: 'Venezuela' },
    { icon: 'ğŸ‡»ğŸ‡³', country: 'Vietnam' },
    { icon: 'ğŸ‡¼ğŸ‡«', country: 'Wallis and Futuna' },
    { icon: 'ğŸ‡ªğŸ‡­', country: 'Western Sahara' },

    { icon: 'ğŸ‡¾ğŸ‡ª', country: 'Yemen' },

    { icon: 'ğŸ‡¿ğŸ‡²', country: 'Zambia' },
    { icon: 'ğŸ‡¿ğŸ‡¼', country: 'Zimbabwe' }
];

const InquireItem = ({ imgUrl, productName, productDesc, size, setInquireItem, inquire, hoverable }: ProdCard) => {
  const [step, nextStep] = useState(0);
  const [userInfo, storeUserInfo] = useState({
    name: '',
    contact: '',
    email: '',
    subject: `Product Inquiry: ${productName}`,
  });
  const [emailContent, setEmailContent] = useState(<>
                    Hello <strong>OnTap Sales/Marketing Team</strong>,
                    <br /><br />
                    I hope this message finds you well. I am reaching out to inquire about the availability and details of your <strong>{productName} OnTap Card</strong> product. Could you kindly provide me with information regarding:
                    <br /><br />
                    <ul className="list-disc list-inside space-y-2 pl-3">
                        <li>Pricing for different quantities</li>
                        <li>Available sizes and material options</li>
                        <li>Estimated production and delivery time</li>
                    </ul>

                    <br />
                    If there are any design guidelines or minimum order requirements, I would also appreciate it if you could share those details.
                    <br /><br />
                    Thank you in advance for your assistance. I look forward to your reply.
                    <br /><br />
                    Best regards,
                    <br />
                   
                    <strong className='capitalize'>{userInfo.name}</strong>
                    <br />
                    <strong>{userInfo.contact}</strong>
                    <br />
                    <strong className='lowercase'>{userInfo.email}</strong>
                </>);
                    const emailRef = useRef<HTMLDivElement | null>(null);
                    const [otp, setOtp] = useState<string>("".padEnd(6, " ")); // OTP as string
                    const inputRefs = useRef<(HTMLInputElement | null)[]>([]);
                    
                    const getInputs = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
                        const { name, value } = e.target;
                        storeUserInfo((prev) => ({
                            ...prev,
                            [name]: value,
    }));
  }

    const submitEmail = async () => {
    if (step === 0) {
        if (!userInfo.name || !userInfo.contact || !userInfo.email) {
            alert('Please fill out all required fields.');
        } else {
            try {
                const res = await fetch('/api/email-verification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        email: userInfo.email,
                        name: userInfo.name,
                    }),
                });

                const data = await res.json();

                if (data.success) {
                    alert('OTP sent successfully!');
                    nextStep(1);
                } else {
                    alert('Failed to send OTP: ' + data.message)
                }
            } catch (err) {
                console.log('Error sending OTP: ' + err);
            }
        }
    } else if (step === 1) {
        try {
            const res = await fetch('/api/verify-otp', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: userInfo.email,
                    otp: otp,
                }),
            });

            const data = await res.json();

            if (data.success) {
                alert('OTP Matched.');
                nextStep(2);
                setEmailContent(
                <>
                    Hello <strong>OnTap Sales/Marketing Team</strong>,
                    <br />
                    <br />
                    I hope this message finds you well. I am reaching out to inquire about the availability and details of your{' '}
                    <strong>{productName}</strong> product. Could you kindly provide me with information regarding:
                    <br />
                    <br />
                    <ul className="list-disc list-inside space-y-2 pl-3">
                    <li>Pricing for different quantities</li>
                    <li>Available sizes and material options</li>
                    <li>Estimated production and delivery time</li>
                    </ul>
                    <br />
                    If there are any design guidelines or minimum order requirements, I would also appreciate it if you could share those details.
                    <br />
                    <br />
                    Thank you in advance for your assistance. I look forward to your reply.
                    <br />
                    <br />
                    Best regards,
                    <br />
                    <strong className="capitalize">{userInfo.name}</strong>
                    <br />
                    <strong>{userInfo.contact}</strong>
                    <br />
                    <strong className="lowercase">{userInfo.email}</strong>
                </>
                );
            } else { alert('OTP not matched.')}
        } catch (err) { console.log(err) };
    } else {
        const messageHtml = emailRef.current?.innerHTML || '';

        const payload = {
            email: userInfo.email,
            name: userInfo.name,
            subject: userInfo.subject,
            message: messageHtml,
            time: new Date().toLocaleString()
        };

        try {
        const res = await fetch('/api/product-inquiry-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
        });

        const data = await res.json();

        if (data.success) {
            alert('Message sent successfully!');
            nextStep(0);
            storeUserInfo({
            name: '',
            contact: '',
            email: '',
            subject: `Product Inquiry: ${productName}`,
            });
            setOtp('');
        } else {
            alert(`Error: ${data.message}`);
        }
        } catch (error) {
            console.error('Error sending email:', error);
            alert('An unexpected error occurred.');
        }
    }
    };

  const handleInput = (e: React.ChangeEvent<HTMLInputElement>, index: number) => {
    let value = e.target.value;

    // only keep one digit
    if (value.length > 1) {
      value = value.charAt(0);
    }

    // update OTP string
    const otpArray = otp.split("");
    otpArray[index] = value;
    const newOtp = otpArray.join("");
    setOtp(newOtp);

    // move focus to next input automatically
    if (value && index < inputRefs.current.length - 1) {
      inputRefs.current[index + 1]?.focus();
    }
  };

  // clear this and all next inputs
  const handleClick = (index: number) => {
    const otpArray = otp.split("");
    for (let i = index; i < otpArray.length; i++) {
      otpArray[i] = " ";
    }
    setOtp(otpArray.join(""));
  };

  return (
    <div className='h-full w-full fixed top-0 left-0 bg-white/15 backdrop-blur-md z-100 flex items-center justify-center'>
        <div className='md:w-3/4 lg:w-1/2 h-2/3 rounded-xl bg-white shadow-md flex p-3'>
            <ProductCard  
              imgUrl={imgUrl}
              productName={productName}
              productDesc={productDesc}
              size={size}
              setInquireItem={setInquireItem} 
              inquire={inquire}
              hoverable={hoverable}
            />
            <div className='h-full w-3/5 flex flex-col items-end gap-5'>
                <span className='w-full flex justify-between items-start'>
                    <span className='flex gap-3 items-center ml-10 mt-3'>
                        <Image
                            alt='gmail icon'
                            height={500}
                            width={500}
                            src='/icons/gmaillogo.png'
                            className='w-8 aspect-square object-contain object-center'
                        />
                        <p className='font-semibold'>{step === 0 ? 'Leave Us a Message' : 'Account Verification'}</p>
                    </span>
                    <button 
                        type="button"
                        className='text-3xl text-neutral-400 rounded-full hover:bg-light-blue hover:text-rose-300 focus:bg-blue focus:text-rose-500 ease-out duration-200'
                        onClick={() => setInquireItem(false)}
                    ><HiOutlineXMark /></button>
                </span>
                <div className='h-full w-full px-10 flex flex-col gap-3 overflow-hidden mt-10'>
                    { step === 0 && (
                        <>
                            <span className='px-5 py-3 rounded-md border border-neutral-200'>
                                <input 
                                    name='name'
                                    type="text" 
                                    placeholder='Name'
                                    value={userInfo.name}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none capitalize'
                                />
                            </span>
                            <span className='px-5 py-3 rounded-md border border-neutral-200 flex gap-2 relative'>
                                <div>
                                    <input type="text" name="" id="" />
                                    <button type="button"></button>
                                </div>
                                <input 
                                    name='contact'
                                    type="text" 
                                    placeholder='Contact Number'
                                    value={userInfo.contact}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none'
                                />
                            </span>
                            <span className='px-5 py-3 rounded-md border border-neutral-200'>
                                <input 
                                    name='email'
                                    type="email" 
                                    placeholder='Email Address'
                                    value={userInfo.email}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none lowercase placeholder:capitalize'
                                />
                            </span>
                        </>
                    )}
                    { step === 1 && (
                        <>
                            <p>We sent a One-Time Code to your email  <strong>{userInfo.email}</strong>. Please check and input the OTP Key below.</p>
                            <span className='mt-auto grid grid-cols-6 gap-3 px-14'>
                                {[...Array(6)].map((_, index) => (
                                    <input
                                    key={index}
                                    type="text"
                                    inputMode="numeric"
                                    pattern="[0-9]*"
                                    maxLength={1}
                                    value={otp[index] === " " ? "" : otp[index] ?? ""}
                                    className="p-3 border border-gray-400 rounded-md text-center text-3xl text-dark-blue font-bold focus:outline-blue ease-out duration-200"
                                    ref={(el) => {
                                        inputRefs.current[index] = el;
                                    }}
                                    onChange={(e) => handleInput(e, index)}
                                    onClick={() => handleClick(index)}
                                    />
                                ))}
                            </span>
                        </>
                    )}
                    { step === 2 && (
                        <>
                            <span className='px-5 py-3 rounded-md border border-neutral-200'>
                                <input 
                                    name='subject'
                                    type="text" 
                                    placeholder='Subject'
                                    value={userInfo.subject}
                                    onChange={getInputs}
                                    className='h-full w-full outline-none'
                                />
                            </span>
                            <div
                                ref={emailRef}
                                contentEditable
                                suppressContentEditableWarning
                                className="overflow-x-hidden px-5 py-3 rounded-md border border-neutral-200 outline-none min-h-[200px] whitespace-pre-wrap"
                            >
                                {emailContent}
                            </div>
                        </>
                    )}
                    <span className='w-full flex justify-end gap-2 mt-5'>
                        { step > 0 && (
                            <button 
                                type="button"
                                className='flex gap-2 px-4 py-2 rounded-md border border-neutral-400 text-neutral-400 items-center hover:border-neutral-700 hover:text-neutral-600 focus:border-black focus:text-black ease-out duration-200'
                                onClick={() => { step === 2 ? nextStep(1) : nextStep(0)}}
                            >Back</button>
                        )}
                        <button 
                            type="button" 
                            className='flex gap-2 px-4 py-2 rounded-md bg-light-blue items-center hover:bg-blue focus:bg-dark-blue focus:text-white ease-out duration-200'
                            onClick={submitEmail}
                        >Next<HiOutlineArrowLongRight /></button>
                    </span>
                    <span className='w-full grid grid-cols-2 gap-3 mt-auto mb-5'>
                        <p className='col-span-full'>You can also reach out via </p>
                        <a
                            href='tel:+639286935815'                            
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        ><HiPhone className='text-2xl'/>+63 928 693 5815</a>
                        <a
                            href='tel:+639772473179'                            
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        ><HiPhone className='text-2xl'/>+63 977 247 3179</a>
                        <a
                            href='https://web.facebook.com/burnboxprinting'
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        ><FaFacebookSquare className='text-2xl text-blue-700'/>/burnboxprinting</a>
                        <a
                            href="https://burnboxprinting.com/" 
                            target="_blank"
                            className='col-span-1 flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        >
                            <HiOutlineGlobeAlt className='text-2xl text-rose-500'/>
                            burnboxprinting.com
                        </a>
                        <a 
                            href="https://www.google.com/maps/place/17+Vatican+City+Dr,+Las+Pi%C3%B1as" 
                            target="_blank"
                            className='col-span-full flex gap-2 items-center hover:underline focus:underline ease-out duration-200'
                        >
                            <HiLocationMarker className='text-2xl text-rose-700'/>
                            17 Vatican City Dr, BF Resort Village, Talon 2, Las PiÃ±as City
                        </a>
                    </span>
                </div>
            </div>
        </div>
    </div>
  )
}

export default InquireItem